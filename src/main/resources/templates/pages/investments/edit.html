<!DOCTYPE html>
<html lang="pt" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/main}">

<head>
    <title>Editar Investimento - MyFinances</title>
</head>

<body>
    <div layout:fragment="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h1 class="h3 text-gray-800">
                            <i class="fas fa-edit me-2"></i>Editar Investimento
                        </h1>
                        <a th:href="@{/investments}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i> Voltar ao Portfolio
                        </a>
                    </div>

                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card shadow">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">
                                        Editando: <span th:text="${investment.product.name}">Product Name</span>
                                        (<span th:text="${investment.product.symbol}">SYMBOL</span>)
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <form th:action="@{/investments/edit/{id}(id=${investment.id})}" method="post" th:object="${investmentForm}">
                                        
                                        <!-- Hidden product ID -->
                                        <input type="hidden" th:field="*{productId}">

                                        <!-- Product Info (Read-only) -->
                                        <div class="alert alert-info" role="alert">
                                            <h6 class="alert-heading">
                                                <i class="fas fa-info-circle me-2"></i>Produto de Investimento
                                            </h6>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <strong>Nome:</strong> <span th:text="${investment.product.name}">Product Name</span><br>
                                                    <strong>Símbolo:</strong> <span th:text="${investment.product.symbol}">SYMBOL</span><br>
                                                    <strong>Tipo:</strong> <span th:text="${investment.product.type.displayName}">Type</span>
                                                </div>
                                                <div class="col-md-6">
                                                    <strong>Preço Atual:</strong> <span th:text="${investment.product.formattedPrice}">0.00 USD</span><br>
                                                    <strong>Exchange:</strong> <span th:text="${investment.product.exchange}">Exchange</span><br>
                                                    <strong>Moeda:</strong> <span th:text="${investment.product.currency}">Currency</span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <!-- Quantity -->
                                            <div class="col-md-6">
                                                <div class="form-group mb-3">
                                                    <label for="quantity">Quantidade *</label>
                                                    <input type="number" class="form-control" id="quantity" 
                                                           th:field="*{quantity}" step="0.000001" min="0.000001" required>
                                                    <div th:if="${#fields.hasErrors('quantity')}" class="invalid-feedback d-block">
                                                        <span th:errors="*{quantity}"></span>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Purchase Price -->
                                            <div class="col-md-6">
                                                <div class="form-group mb-3">
                                                    <label for="purchasePrice">Preço de Compra *</label>
                                                    <input type="number" class="form-control" id="purchasePrice" 
                                                           th:field="*{purchasePrice}" step="0.01" min="0.01" required>
                                                    <div th:if="${#fields.hasErrors('purchasePrice')}" class="invalid-feedback d-block">
                                                        <span th:errors="*{purchasePrice}"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <!-- Purchase Date -->
                                            <div class="col-md-6">
                                                <div class="form-group mb-3">
                                                    <label for="purchaseDate">Data de Compra *</label>
                                                    <input type="date" class="form-control" id="purchaseDate" 
                                                           th:field="*{purchaseDate}" required>
                                                    <div th:if="${#fields.hasErrors('purchaseDate')}" class="invalid-feedback d-block">
                                                        <span th:errors="*{purchaseDate}"></span>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Exchange Rate -->
                                            <div class="col-md-6">
                                                <div class="form-group mb-3">
                                                    <label for="exchangeRate">Taxa de Câmbio (para EUR)</label>
                                                    <input type="number" class="form-control" id="exchangeRate" 
                                                           th:field="*{exchangeRate}" step="0.000001" min="0.000001">
                                                    <div th:if="${#fields.hasErrors('exchangeRate')}" class="invalid-feedback d-block">
                                                        <span th:errors="*{exchangeRate}"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Notes -->
                                        <div class="form-group mb-3">
                                            <label for="notes">Notas</label>
                                            <textarea class="form-control" id="notes" th:field="*{notes}" rows="3"
                                                      placeholder="Notas sobre este investimento..."></textarea>
                                        </div>

                                        <div class="form-group">
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-1"></i> Guardar Alterações
                                            </button>
                                            <a th:href="@{/investments}" class="btn btn-secondary ms-2">Cancelar</a>
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Investment Summary -->
                        <div class="col-lg-4">
                            <div class="card shadow">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Resumo do Investimento</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <strong>Total Investido:</strong><br>
                                        <span class="h5" th:text="${investment.formattedTotalInvested}">1000.00 USD</span>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <strong>Valor Atual:</strong><br>
                                        <span class="h5" th:text="${investment.formattedCurrentValue}">1100.00 USD</span>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <strong>Ganho/Perda:</strong><br>
                                        <span class="h5" th:class="${investment.gainLossCssClass}" 
                                              th:text="${investment.formattedTotalGainLoss}">+100.00 USD</span>
                                        <br>
                                        <small th:class="${investment.gainLossCssClass}"
                                               th:text="${investment.formattedPercentageGainLoss}">+10.00%</small>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <strong>Criado em:</strong><br>
                                        <small th:text="${#temporals.format(investment.createdAt, 'dd/MM/yyyy HH:mm')}">01/01/2024 10:30</small>
                                    </div>
                                </div>
                            </div>

                            <div class="card shadow mt-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">Informações do Produto</h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2" th:if="${investment.product.peRatio}">
                                        <strong>P/E Ratio:</strong> <span th:text="${investment.product.formattedPeRatio}">25.5</span>
                                    </div>
                                    <div class="mb-2" th:if="${investment.product.marketCap}">
                                        <strong>Market Cap:</strong> <span th:text="${investment.product.formattedMarketCap}">2.5T</span>
                                    </div>
                                    <div class="mb-2" th:if="${investment.product.dividendYield}">
                                        <strong>Dividend Yield:</strong> <span th:text="${investment.product.formattedDividendYield}">2.5%</span>
                                    </div>
                                    <div class="mb-2" th:if="${investment.product.beta}">
                                        <strong>Beta:</strong> <span th:text="${investment.product.formattedBeta}">1.2</span>
                                    </div>
                                    <div class="mb-2" th:if="${investment.product.sector}">
                                        <strong>Setor:</strong> <span th:text="${investment.product.sector}">Technology</span>
                                    </div>
                                    
                                    <div class="mt-3">
                                        <small class="text-muted">
                                            <strong>Última atualização dos preços:</strong><br>
                                            <span th:if="${investment.product.lastUpdated}"
                                                  th:text="${#temporals.format(investment.product.lastUpdated, 'dd/MM/yyyy HH:mm')}">
                                                01/01/2024 10:30
                                            </span>
                                            <span th:unless="${investment.product.lastUpdated}">N/A</span>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</body>
</html>